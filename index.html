<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 線上排班系統</title>
    
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 設定 Tailwind CSS 顏色，確保列印樣式正常 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'accent-blue': '#4c7cff',
                        'accent-dark': '#2c435a',
                    }
                }
            }
        }
    </script>
    
    <!-- 載入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 載入 Babel (用於瀏覽器端編譯 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 載入 Lucide React 圖示庫 (假設已在 Babel 環境中可用) -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.min.js"></script>

    <style>
        /* 列印樣式設定 */
        @media print {
            /* 橫向列印，縮小邊距 */
            @page { size: landscape; margin: 5mm; } 
            /* 允許背景顏色和圖片列印 */
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } 
            /* 隱藏不必要的元素 */
            .print\:hidden { display: none !important; }
            /* 顯示列印專屬元素 */
            .print\:block { display: block !important; }
            /* 縮小字體 */
            .print\:text-xs { font-size: 10px !important; }
        }
        /* 主體背景色 */
        body {
            background-color: #f7f9fb;
            font-family: 'Inter', sans-serif;
        }
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
    </style>

    <!-- 載入 Firebase SDK V9 (模組化) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 導出 (export) 函式和物件，供 Babel 腳本使用
        window.firebase = {
            initializeApp,
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged,
            getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, getDocs, setLogLevel
        };
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // 從 window 取得 Firebase 函式
        const { initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, getFirestore, doc, setDoc, onSnapshot, collection, setLogLevel } = window.firebase;
        const { useState, useEffect, useCallback, useMemo } = React;
        const { Calendar, Users, Upload, Download, Printer } = lucide;

        // 設定 Firestore Log Level 以進行除錯
        setLogLevel('debug');

        // --- 排班資料結構與輔助函式 ---

        // 班別定義
        const SHIFTS = ['A07', 'A08', 'B06', 'B07', 'R', 'H', 'O'];
        const SHIFT_CLASSES = {
            'A07': 'bg-green-100', // 早班
            'A08': 'bg-green-200',
            'B06': 'bg-blue-100', // 晚班
            'B07': 'bg-blue-200',
            'R': 'text-red-600 font-bold bg-red-50', // 例假
            'H': 'text-red-600 font-bold bg-red-50', // 國定假日
            'O': 'text-red-600 font-bold bg-red-50', // 其他
        };

        // 輔助函式：取得月份天數
        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();

        // 輔助函式：格式化日期 'YYYY-MM-DD'
        const formatDate = (date) => date.toISOString().split('T')[0];
        
        // 輔助函式：取得月份的第一天
        const getMonthStart = (year, month) => new Date(year, month, 1);

        // 輔助函式：日期加天數
        const addDays = (date, days) => {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        };

        // 輔助函式：檢查是否為國定假日 (假設 2026/2/16, 2/28, 4/3, 4/6, 5/1, 6/22 為國定假日)
        const isHoliday = (dateStr) => {
            return ['2026-01-01', '2026-02-16', '2026-02-28', '2026-04-03', '2026-04-06', '2026-05-01', '2026-06-22'].includes(dateStr);
        };

        // 輔助函式：檢查是否為週六或週日
        const isWeekend = (date) => {
            const day = date.getDay();
            return day === 0 || day === 6; // 0 = Sunday, 6 = Saturday
        };
        
        // 輔助函式：檢查是否為四週變形工時的結算日 (假設為每四週的最後一天，範例中為 1/18, 2/15, 3/15, 4/12, 5/10, 6/7)
        const isCycleEnd = (dateStr) => {
            return ['2026-01-18', '2026-02-15', '2026-03-15', '2026-04-12', '2026-05-10', '2026-06-07'].includes(dateStr);
        };

        // --- 主要應用程式元件 ---

        const App = () => {
            // Firebase 狀態
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [userId, setUserId] = useState(null);
            const [isAuthReady, setIsAuthReady] = useState(false);
            const [dbError, setDbError] = useState(null);

            // 應用程式狀態
            const [currentMonth, setCurrentMonth] = useState(0); // 0=Jan, 1=Feb, ...
            const [currentYear, setCurrentYear] = useState(2026);
            const [shiftData, setShiftData] = useState({}); // 儲存 Firebase 資料: {dateStr: {user1: shiftA, user2: shiftB}}
            const [users, setUsers] = useState({}); // {userId: {name: '...'}, ...}
            const [isLoading, setIsLoading] = useState(true);
            const [userName, setUserName] = useState('');
            const [currentUserDocId, setCurrentUserDocId] = useState(null);
            
            // 系統訊息
            const [message, setMessage] = useState('');

            // 月份標籤 (簡體中文因 Babel 無法處理繁體中文的特殊字元)
            const MONTH_NAMES = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            const WEEKDAY_NAMES = ['日', '一', '二', '三', '四', '五', '六'];

            // --- Firebase 初始化與認證 ---
            useEffect(() => {
                let unsubscribeAuth = () => {};
                
                try {
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

                    if (Object.keys(firebaseConfig).length === 0) {
                        setDbError("Firebase 配置缺失。請檢查 __firebase_config 變數。");
                        setIsAuthReady(true);
                        return;
                    }

                    const app = initializeApp(firebaseConfig);
                    const firestore = getFirestore(app);
                    const authService = getAuth(app);

                    setDb(firestore);
                    setAuth(authService);
                    
                    // 認證邏輯
                    const authenticate = async () => {
                        try {
                            if (initialAuthToken) {
                                // 修正 V9 函式呼叫錯誤：使用 signInWithCustomToken(auth, token)
                                await signInWithCustomToken(authService, initialAuthToken);
                            } else {
                                await signInAnonymously(authService);
                            }
                        } catch (e) {
                            console.error("Firebase 認證失敗，嘗試匿名登入：", e);
                            setDbError(`認證失敗: ${e.message}`);
                            await signInAnonymously(authService);
                        }
                    };

                    // 監聽 Auth 狀態變化
                    unsubscribeAuth = onAuthStateChanged(authService, (user) => {
                        if (user) {
                            setUserId(user.uid);
                            // 載入用戶名稱 (可選，但保持一致)
                            loadUserName(firestore, user.uid);
                        } else {
                            // 應急 ID，但在本環境中應總是有一個 user
                            setUserId(crypto.randomUUID()); 
                        }
                        setIsAuthReady(true);
                        setIsLoading(false);
                    });

                    authenticate();

                } catch (e) {
                    console.error("Firebase 初始化失敗:", e);
                    setDbError(`初始化失敗: ${e.message}`);
                    setIsAuthReady(true);
                    setIsLoading(false);
                }

                return () => unsubscribeAuth(); // 清理 Auth 監聽器
            }, []);
            
            // 載入用戶名稱
            const loadUserName = useCallback(async (firestore, uid) => {
                if (!uid) return;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const userDocRef = doc(firestore, `artifacts/${appId}/public/data/users/${uid}`);
                try {
                    const userSnap = await getDoc(userDocRef);
                    if (userSnap.exists()) {
                        const data = userSnap.data();
                        setUserName(data.name || '用戶 ' + uid.substring(0, 4));
                        setCurrentUserDocId(uid);
                    } else {
                        // 如果用戶文檔不存在，則提示用戶設定名稱
                        setUserName('新用戶');
                    }
                } catch (e) {
                    console.error("載入用戶名稱失敗:", e);
                }
            }, []);

            // --- 載入和監聽 Firestore 資料 ---
            useEffect(() => {
                if (!db || !isAuthReady || !userId) return;

                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const shiftColRef = collection(db, `artifacts/${appId}/public/data/shifts`);
                const userColRef = collection(db, `artifacts/${appId}/public/data/users`);

                // 1. 監聽班表資料 (shifts)
                const unsubscribeShifts = onSnapshot(shiftColRef, (snapshot) => {
                    const newShiftData = {};
                    snapshot.forEach(doc => {
                        newShiftData[doc.id] = doc.data(); // doc.id is the date string (YYYY-MM-DD)
                    });
                    setShiftData(newShiftData);
                }, (error) => {
                    console.error("監聽班表資料失敗:", error);
                    setDbError(`監聽錯誤: ${error.message}`);
                });

                // 2. 監聽用戶資料 (users)
                const unsubscribeUsers = onSnapshot(userColRef, (snapshot) => {
                    const newUsers = {};
                    snapshot.forEach(doc => {
                        newUsers[doc.id] = doc.data();
                    });
                    setUsers(newUsers);
                    
                    // 確保目前用戶名稱已設定
                    if (newUsers[userId] && newUsers[userId].name) {
                        setUserName(newUsers[userId].name);
                        setCurrentUserDocId(userId);
                    }
                }, (error) => {
                    console.error("監聽用戶資料失敗:", error);
                    setDbError(`監聽錯誤: ${error.message}`);
                });

                return () => {
                    unsubscribeShifts();
                    unsubscribeUsers();
                };
            }, [db, isAuthReady, userId]);

            // --- 事件處理函式 ---

            const handleUserNameChange = async (e) => {
                const newName = e.target.value.trim();
                setUserName(newName);

                if (!db || !userId || newName.length < 2) return;

                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const userDocRef = doc(db, `artifacts/${appId}/public/data/users/${userId}`);

                try {
                    await setDoc(userDocRef, { name: newName }, { merge: true });
                    setMessage('用戶名稱已更新！');
                    setCurrentUserDocId(userId);
                } catch (e) {
                    console.error("更新用戶名稱失敗:", e);
                    setMessage(`更新用戶名稱失敗: ${e.message}`);
                }
            };
            
            const handleShiftChange = useCallback(async (dateStr, shift) => {
                if (!db || !userId || !currentUserDocId) {
                    setMessage("請先設定用戶名稱！");
                    return;
                }

                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const shiftDocRef = doc(db, `artifacts/${appId}/public/data/shifts/${dateStr}`);
                
                // 準備更新的資料
                const updateData = {
                    [currentUserDocId]: shift
                };
                
                try {
                    // 使用 setDoc 配合 merge: true，避免覆蓋其他日期或欄位
                    await setDoc(shiftDocRef, updateData, { merge: true });
                    setMessage(`已更新 ${dateStr} 的班別為 ${shift}`);
                } catch (e) {
                    console.error("更新班別失敗:", e);
                    setMessage(`更新班別失敗: ${e.message}`);
                }

            }, [db, userId, currentUserDocId]);

            const handleDateChange = (type) => {
                let newMonth = currentMonth;
                let newYear = currentYear;

                if (type === 'next') {
                    newMonth += 1;
                    if (newMonth > 11) {
                        newMonth = 0;
                        newYear += 1;
                    }
                } else if (type === 'prev') {
                    newMonth -= 1;
                    if (newMonth < 0) {
                        newMonth = 11;
                        newYear -= 1;
                    }
                }
                
                // 限制在 2026 年
                if (newYear !== 2026) return; 

                setCurrentMonth(newMonth);
                setCurrentYear(newYear);
            };

            const handlePrint = () => {
                window.print();
            };
            
            // --- 資料計算與渲染準備 ---

            // 當前月份的日期陣列
            const dateArray = useMemo(() => {
                const numDays = getDaysInMonth(currentYear, currentMonth);
                const startDate = getMonthStart(currentYear, currentMonth);
                const days = [];
                for (let i = 0; i < numDays; i++) {
                    days.push(formatDate(addDays(startDate, i)));
                }
                return days;
            }, [currentYear, currentMonth]);

            // 班表數據轉換 (日期 -> {user1: shiftA, user2: shiftB, ...})
            const scheduleData = useMemo(() => {
                return dateArray.reduce((acc, dateStr) => {
                    acc[dateStr] = shiftData[dateStr] || {};
                    return acc;
                }, {});
            }, [dateArray, shiftData]);

            // 用戶列表 (排除空用戶)
            const userList = useMemo(() => {
                return Object.entries(users)
                    .filter(([uid, data]) => data.name && data.name.trim() !== '')
                    .map(([uid, data]) => ({ uid, name: data.name }))
                    // 將當前用戶排在最前面
                    .sort((a, b) => a.uid === userId ? -1 : (b.uid === userId ? 1 : a.name.localeCompare(b.name, 'zh-TW')));
            }, [users, userId]);
            
            // 班次統計 (計算每天的早/晚班人力)
            const dailySummary = useMemo(() => {
                return dateArray.map(dateStr => {
                    const shifts = scheduleData[dateStr] || {};
                    let morningCount = 0; // A07, A08
                    let nightCount = 0;   // B06, B07
                    
                    Object.values(shifts).forEach(shift => {
                        if (shift === 'A07' || shift === 'A08') morningCount++;
                        if (shift === 'B06' || shift === 'B07') nightCount++;
                    });

                    // 檢查人力規則
                    const dateObj = new Date(dateStr);
                    const isSpecificHoliday = dateStr === '2026-02-16'; // 僅需 1早
                    const isNormalDay = !isWeekend(dateObj) && !isHoliday(dateStr);
                    const isWkndOrHol = isWeekend(dateObj) || (isHoliday(dateStr) && !isSpecificHoliday);

                    let isValid = true;
                    let ruleText = '';
                    
                    if (isSpecificHoliday) {
                        // 2/16 僅需 1早
                        if (morningCount !== 1) {
                            isValid = false;
                            ruleText = '2/16人力不足 (需 1早)';
                        }
                    } else if (isWkndOrHol) {
                        // 假日/國定假日需剛好 1早1晚
                        if (morningCount !== 1 || nightCount !== 1) {
                            isValid = false;
                            ruleText = '假日人力不足 (需 1早1晚)';
                        }
                    } else if (isNormalDay) {
                        // 一般日至少 1早1晚 (假設規則，或根據實際需求調整)
                        if (morningCount < 1 || nightCount < 1) {
                            // 這裡可以根據實際規則來設定
                            // isValid = false;
                            // ruleText = '一般日人力不足 (至少 1早1晚)';
                        }
                    }

                    return { dateStr, morningCount, nightCount, isValid, ruleText };
                });
            }, [dateArray, scheduleData]);
            
            // --- 介面元件 ---

            // 用戶名稱設定面板
            const UserProfile = () => (
                <div className="flex items-center space-x-2 p-2 bg-white rounded-lg shadow-sm border print:hidden">
                    <Users className="w-5 h-5 text-accent-blue" />
                    <label htmlFor="userNameInput" className="text-sm font-medium text-gray-700">我的名字:</label>
                    <input
                        id="userNameInput"
                        type="text"
                        value={userName}
                        onChange={(e) => setUserName(e.target.value)}
                        onBlur={handleUserNameChange}
                        placeholder="請輸入您的姓名"
                        className="flex-grow p-2 text-sm border border-gray-300 rounded-md focus:ring-accent-blue focus:border-accent-blue transition duration-150"
                        disabled={!isAuthReady || isLoading}
                    />
                    <div className="text-xs text-gray-500 hidden sm:block">
                        <span className="font-mono">ID: {userId ? userId.substring(0, 8) + '...' : 'N/A'}</span>
                    </div>
                </div>
            );

            // 班表表格元件
            const ShiftTable = ({ dateArray, scheduleData, userList, dailySummary }) => {
                if (userList.length === 0) {
                    return (
                        <div className="text-center p-8 text-gray-500">
                            請在上方設定您的名稱，並等待其他用戶加入。
                        </div>
                    );
                }

                return (
                    <div className="overflow-x-auto rounded-lg shadow-xl mt-6 bg-white border border-gray-200">
                        <table className="min-w-full divide-y divide-gray-200">
                            {/* 表格標頭 */}
                            <thead className="bg-accent-dark text-white sticky top-0">
                                <tr>
                                    <th className="px-3 py-2 text-left text-xs font-medium uppercase tracking-wider sticky left-0 z-10 bg-accent-dark min-w-[80px]">
                                        姓名
                                    </th>
                                    {dateArray.map((dateStr) => {
                                        const date = new Date(dateStr);
                                        const day = date.getDate();
                                        const weekday = WEEKDAY_NAMES[date.getDay()];
                                        const isWeekendOrHoliday = isWeekend(date) || isHoliday(dateStr);
                                        const isToday = dateStr === formatDate(new Date());

                                        return (
                                            <th key={dateStr} className={`px-2 py-2 text-xs font-medium border-l border-gray-600 ${isWeekendOrHoliday ? 'bg-red-700' : ''} ${isToday ? 'bg-yellow-600' : ''} min-w-[60px] text-center`}>
                                                <div className="flex flex-col">
                                                    <span>{day} ({weekday})</span>
                                                </div>
                                            </th>
                                        );
                                    })}
                                </tr>
                            </thead>
                            
                            {/* 表格內容 (用戶班表) */}
                            <tbody className="bg-white divide-y divide-gray-200">
                                {userList.map(({ uid, name }) => (
                                    <tr key={uid} className={uid === userId ? 'bg-blue-50/70 hover:bg-blue-100 transition' : 'hover:bg-gray-50 transition'}>
                                        <td className={`px-3 py-2 whitespace-nowrap text-sm font-medium sticky left-0 z-10 ${uid === userId ? 'bg-blue-100 font-bold' : 'bg-white'}`}>
                                            {name}
                                        </td>
                                        {dateArray.map((dateStr) => {
                                            const currentShift = scheduleData[dateStr][uid] || '';
                                            const isCycleEndDay = isCycleEnd(dateStr);
                                            
                                            // 檢查班別規則：B06 隔天僅能排 A07
                                            let isRuleViolation = false;
                                            if (currentShift === 'B06') {
                                                const nextDayStr = formatDate(addDays(new Date(dateStr), 1));
                                                const nextDayShift = scheduleData[nextDayStr]?.[uid];
                                                if (nextDayShift && nextDayShift !== 'A07') {
                                                    isRuleViolation = true;
                                                }
                                            }

                                            return (
                                                <td 
                                                    key={dateStr} 
                                                    className={`px-1 py-1 text-sm text-gray-900 border-l border-b border-gray-200 ${SHIFT_CLASSES[currentShift] || 'bg-white'} ${isCycleEndDay ? 'border-r-yellow-400 border-r-2 bg-yellow-50' : ''} ${isRuleViolation ? 'bg-red-200/80 ring-2 ring-red-500' : ''} text-center`}
                                                >
                                                    <select
                                                        value={currentShift}
                                                        onChange={(e) => handleShiftChange(dateStr, e.target.value)}
                                                        className={`w-full text-center text-xs font-medium border-none rounded-md bg-transparent focus:ring-1 focus:ring-accent-blue cursor-pointer ${SHIFT_CLASSES[currentShift] || 'bg-white'}`}
                                                        disabled={!currentUserDocId || uid !== userId} // 只有本人可以編輯自己的班表
                                                    >
                                                        <option value="">--</option>
                                                        {SHIFTS.map(shift => (
                                                            <option key={shift} value={shift}>{shift}</option>
                                                        ))}
                                                    </select>
                                                </td>
                                            );
                                        })}
                                    </tr>
                                ))}
                            </tbody>
                            
                            {/* 底部總結 (人力統計) */}
                            <tfoot className="bg-gray-100">
                                <tr className="border-t border-gray-300 font-semibold">
                                    <td className="px-3 py-2 sticky left-0 z-10 bg-accent-dark text-white text-xs">
                                        人力總結
                                    </td>
                                    {dailySummary.map(({ dateStr, morningCount, nightCount, isValid, ruleText }) => (
                                        <td key={dateStr} 
                                            title={isValid ? '人力達標' : ruleText}
                                            className={`text-center py-1 border-r border-b border-gray-300 text-[10px] ${isValid ? '' : 'bg-red-100 ring-2 ring-red-400'} ${isCycleEnd(dateStr) ? 'border-r-yellow-400 border-r-2' : ''}`}
                                        >
                                            <div className={`flex flex-col gap-0.5 items-center ${isValid ? 'text-slate-700' : 'text-red-700 font-bold'}`}>
                                                <span>早:{morningCount}</span>
                                                <span>晚:{nightCount}</span>
                                            </div>
                                        </td>
                                    ))}
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                );
            };

            // 渲染主介面
            if (isLoading) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <p className="text-gray-500 text-lg">
                            <Calendar className="inline animate-spin mr-2" /> 系統載入中...
                        </p>
                    </div>
                );
            }
            
            if (dbError) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen p-4">
                        <h1 className="text-2xl font-bold text-red-600 mb-4">系統載入失敗</h1>
                        <p className="text-lg text-gray-700 text-center">{dbError}</p>
                        <p className="mt-4 text-sm text-gray-500">請檢查您的 Firebase Console 設定或網路連線。</p>
                    </div>
                );
            }

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-8">
                    {/* 頂部控制面板 */}
                    <div className="flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0 print:hidden">
                        
                        {/* 月份導航 */}
                        <div className="flex items-center bg-white rounded-lg shadow-md border border-gray-200">
                            <button
                                onClick={() => handleDateChange('prev')}
                                className="p-3 text-accent-dark hover:bg-gray-100 rounded-l-lg transition disabled:opacity-50"
                                disabled={currentMonth === 0}
                            >
                                &lt; 上月
                            </button>
                            <h1 className="text-xl font-bold px-6 text-accent-dark whitespace-nowrap">
                                {currentYear} 年 {MONTH_NAMES[currentMonth]}
                            </h1>
                            <button
                                onClick={() => handleDateChange('next')}
                                className="p-3 text-accent-dark hover:bg-gray-100 rounded-r-lg transition disabled:opacity-50"
                                disabled={currentMonth === 11}
                            >
                                下月 &gt;
                            </button>
                        </div>
                        
                        {/* 用戶配置 */}
                        <UserProfile />
                        
                        {/* 動作按鈕 */}
                        <div className="flex space-x-3">
                            <button
                                onClick={handlePrint}
                                className="flex items-center space-x-2 px-4 py-2 bg-accent-blue text-white rounded-lg shadow-md hover:bg-blue-600 transition"
                            >
                                <Printer className="w-5 h-5" />
                                <span>列印 (橫向)</span>
                            </button>
                            {/* 模擬匯出/匯入按鈕 */}
                            <button
                                className="flex items-center space-x-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg shadow-md hover:bg-gray-300 transition"
                                title="此功能暫未實作"
                            >
                                <Download className="w-5 h-5" />
                            </button>
                        </div>
                    </div>
                    
                    {/* 系統訊息提示 */}
                    {message && (
                        <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-md mb-4 print:hidden" role="alert">
                            <span className="block sm:inline">{message}</span>
                        </div>
                    )}
                    
                    {/* 班表表格 */}
                    <ShiftTable
                        dateArray={dateArray}
                        scheduleData={scheduleData}
                        userList={userList}
                        dailySummary={dailySummary}
                    />
                    
                    {/* 規則說明區塊 */}
                    <div className="mt-8 text-sm text-gray-600 space-y-1 print:hidden p-4 bg-white rounded-lg shadow-md border border-gray-200">
                        <h2 className="font-bold text-lg text-accent-dark mb-2">排班規則與說明</h2>
                        <ul className="list-disc list-inside space-y-1">
                            <li><span className="font-semibold">班別規則：</span>B06 隔天僅能排 A07 (違規日曆格會以 <span className="text-red-600 font-bold">紅色邊框</span> 標示)。</li>
                            <li><span className="font-semibold">人力規則：</span>
                                <ul className="list-circle list-inside ml-4">
                                    <li>假日/國定假日需剛好 <span className="font-bold">1早1晚</span>。</li>
                                    <li>2/16 國定假日較特殊，僅需 <span className="font-bold">1早</span>。</li>
                                    <li>人力不足的日子，<span className="text-red-600 font-bold">人力總結</span> 欄位會以 <span className="bg-red-100 px-1 rounded">淺紅底色</span> 標示。</li>
                                </ul>
                            </li>
                            <li><span className="font-semibold">標示說明：</span>
                                <ul className="list-circle list-inside ml-4">
                                    <li><span className="text-red-600 font-bold">紅色字體班別</span> (如 R/H/O) 為休假日或特殊班。</li>
                                    <li>週期標示：<span className="bg-yellow-50 px-1 rounded">黃色粗線與底色</span> 標示四週變形工時的結算日 (如 1/18, 2/15...)。</li>
                                    <li>當天班次：<span className="bg-blue-100 font-bold">淺藍底色</span> (如 A07, B06) 為一般班次。</li>
                                </ul>
                            </li>
                            <li><span className="font-semibold">編輯權限：</span>只有您本人可以編輯自己列的班別。</li>
                        </ul>
                    </div>
                    
                </div>
            );
        };

        // 渲染應用程式
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);

    </script>
</body>
</html>